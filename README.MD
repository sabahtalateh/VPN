# VPN на Keenetic. Host-based routing

## Покупаем VPS

https://adminvps.ru

На почту придут креды

## Устанавливаем на него Amnezia WireGuard

https://docs.amnezia.org/ru/documentation/instructions/install-vpn-on-server

- Скачиваем инсталятор
- Запускаем и пишем в него креды от VPS
- Ждём пока инсталятор установит Amnezia WireGuard на VPS
- Сохраняем конфигурацию в файл. Для этого нажимаем Share > Share > Save

После этого можно подключиться в VPN прямо из приложение и уже пользоваться

## Добавляем VPN-подключение на роутере

- Устанавливаем модуль `WireGuard VPN` (Настройки > Параметры Системы > Изменить Набор Компонентов)
- Идём в Сеть > Другие подключения
- Загружаем конфигурацию, которую сохранили на предыдущем шаге
- (!) Пока не включаем это подключение
- Заходим в командную строку роутера (192.168.1.1/a)
- Выполняем `show interface`
- Ищем там интерфейс `Wireguard0`
- Выполняем `interface <interface_id> wireguard asc <jc> <min> <max> <s1> <s2> <h1> <h2> <h3> <h4>`. Переменные в скобках берём из сохранённого конфигурационного файла. `interface_id=Wireguard0`
- Теперь можно включить соединение

После этого можно добавить соединение в политику по умолчанию, или создать новую политику и перетащить туда нужных клиентов

## OPKG + HydraRoute

Установим OPKG на внешний USB, подключённый к роутеру


